#!/bin/bash
# Wrapper to launch the PTUI dashboard with the correct Python environment

REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
VENV_PYTHON="$REPO_ROOT/runtime/.venv/bin/python"
DASHBOARD_SCRIPT="$REPO_ROOT/scripts/ptui_dashboard.py"
CONTROL_SERVER_SCRIPT="$REPO_ROOT/scripts/service_control_server.py"

# Ensure we have the correct terminal settings if needed (optional safety)
export TERM="${TERM:-xterm-256color}"
export SERVICE_CONTROL_PORT=8070

# Ensure Service Control Server is running
if ! pgrep -f "service_control_server.py" > /dev/null; then
    echo "Starting Service Control Server..."
    nohup "$VENV_PYTHON" "$CONTROL_SERVER_SCRIPT" > "$REPO_ROOT/logs/service_control.log" 2>&1 &
    # Give it a moment to start
    sleep 1
fi

exec "$VENV_PYTHON" "$DASHBOARD_SCRIPT" "$@"
